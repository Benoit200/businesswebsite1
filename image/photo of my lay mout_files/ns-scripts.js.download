/* ---------------------------------------------- /*
 * Oracle Search
/* ---------------------------------------------- */
function changeNtt() {
	if (document.search.Ntt.value.indexOf(location.hostname.substring(location.hostname.indexOf("netsuite"))) == -1) {
		document.search.Ntt.value = document.search.Ntt.value + " " + location.hostname.substring(location.hostname.indexOf("netsuite"));
	}
	return true;
}

$('.form-btn-search').on("click", function () {
	if (document.search.Ntt.value != "") {
		changeNtt();
		$("#siteSearch").submit();
	}
});

function getBaseDomain() {
	var domain = document.domain;
	var ifirst = domain.indexOf(".");
	domain = domain.substring(ifirst + 1);
	return domain;
}

function setCookie(name, value, expires, path, domain, secure) {
	expDate = new Date();
	expDate.setDate(expDate.getDate() + 30);

	var curCookie = name + "=" + value +
		((expires) ? "; expires=" + expDate.toGMTString() : "") +
		((path) ? "; path=" + path : "") +
		((domain) ? "; domain=" + domain : "") +
		((secure) ? "; secure" : "");
	document.cookie = curCookie;
}

function getCookie(name) {
	var value = "; " + document.cookie;
	var parts = value.split("; " + name + "=");
	if (parts.length == 2) return parts.pop().split(";").shift();
}

function getQueryParameter(param) {
	var idx = document.URL.indexOf(param + "=");
	if (idx != -1) {
		var sidx = idx + param.length + 1;
		var len = document.URL.substring(sidx).indexOf("&");
		if (len == -1)
			return document.URL.substring(sidx);
		else
			return document.URL.substring(sidx, sidx + len);
	} else
		return null;
}

/* ---------------------------------------------- /*
 * Login Redirect Cookie
/* ---------------------------------------------- */
$('#loginBtn').on("click", function () {
	setCookie("loginredirect", true, 30, "/", getBaseDomain(), null);

	var url_string = this.href;
	var url = new URL(url_string);
	var c = url.searchParams.get("country");
	setCookie("logincountry", c, 30, "/", getBaseDomain(), null);

});

function redirecttologin() {
	var redirect = getCookie("loginredirect");
	var noredirect = getQueryParameter("noredirect");
	var country = getCookie("logincountry");

	if (noredirect == null && redirect != null)
		document.location = "https://system.netsuite.com/pages/customerlogin.jsp?country=" + getCookie("logincountry");

	return true;
}
/**
 * Convert date to user's timezone
 * @param {string} dateStr should be in the format of "YYYY-MM-DDTHH:mm:ss.sssZ
 * @returns {string} date in the format like 'January 1, 2021'
 */
function convertToLocalTimezone(dateStr) {
	try {
		const date = new Date(dateStr);
		date.setMinutes(date.getMinutes() - date.getTimezoneOffset());
		const dateOptions = {
			month: "long",
			day: "numeric",
			year: "numeric"
		};
		return date.toLocaleDateString("en-US", dateOptions);
	} catch (error) {
		console.error(error);
		return null;
	}
}